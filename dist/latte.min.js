/*!
 * latte.js
 * --------
 * Simple class and router library
 *
 * @version 0.0.1 (build: 2015-04-18)
 * @author mach3 <http://github.com/mach3>
 * @license MIT
 */
!function(a){var b={},c={type:function(a,b){var c=function(){var b=Object.prototype.toString.call(a).match(/^\[\w+\s(\w+)\]$/);return b?b[1]:void 0}();return b?b===c:c},toArray:function(a){return Array.prototype.slice.call(a)},extend:function(){var a,b,d,e;return a=c.toArray(arguments),b=c.type(a[0],"Boolean")?a.shift():!1,d=c.type(a[0],"Boolean")?a.shift():!0,e=a.shift(),c.each(a,function(a){c.each(a,function(a,f){!d&&f in e||(c.type(a,"Object")&&b?e[f]=c.extend(!0,{},e[f],a):e[f]=a)})}),e},each:function(a,b,c){var d;for(d in a)if((a.hasOwnProperty(d)||c)&&!1===b(a[d],d))break},map:function(a,b){var d,e;if(c.type(Array.prototype.map,"Function"))return a.map(b);for(e=[],d=0;d<a.length;d++)e[d]=b(a[d]);return e},delegate:function(a,b){switch(c.type(b)){case"String":c.type(a[b],"Function")&&(a[b]=a[b].bind(a));break;case"RegExp":c.each(a,function(d,e){b.test(e)&&c.delegate(a,e)},!0);break;case"Array":c.each(b,function(b){c.delegate(a,b)})}return void 0}};b.util=c,b.Class=function(a){var d=function(){var a=this;c.each(this._extended,function(b,d){b=c.type(b,"Function")?b.prototype:b,b._initialize!==a._initialize&&c.type(b._initialize,"Function")&&b._initialize.apply(a,arguments)}),c.delegate(this,/^_/),c.type(this._initialize,"Function")&&this._initialize.apply(this,arguments)};return d.prototype._extended=[],d.extend=function(){var a,d,e;return a=c.toArray(arguments),d=c.type(a[0],"Boolean")?a.shift():!1,e=this,c.each(a,function(a){var f;switch(a=c.type(a,"String")?b.find(a):a,c.type(a)){case"Function":f=a.prototype;break;case"Object":f=a}f&&(c.extend(!0,d,e.prototype,c.extend(!0,{},f)),e.prototype._extended.push(f))}),this},a=void 0===a?{}:a,c.type(a._extend,"Array")&&d.extend.apply(d,a._extend),d.extend(!0,a)},b.Class.Events=b.Class({_handlers:null,_initialize:function(){this._handlers={}},on:function(a,b){var d=this;switch(c.type(a)){case"Object":c.each(a,function(a,b){d.on(b,a)});break;case"String":a in this._handlers||(this._handlers[a]=[]),this._handlers[a].push(b)}return this},off:function(a,b){var d,e;switch(d=arguments,e=[],d.length){case 0:return this._handlers={};case 1:this._handlers[a]=[];break;default:a in this._handlers&&(c.each(this._handlers[a],function(a,c){b!==a&&e.push(a)}),this._handlers[a]=e)}return this},trigger:function(a){var b,d;b=this,d=[{target:this,type:a}].concat(c.toArray(arguments).slice(1)),a in this._handlers&&c.each(this._handlers[a],function(a){a.apply(b,d)})}}),b.Class.Config=b.Class({_options:null,options:null,_initialize:function(){this.options=c.extend(!0,{},this._options)},config:function(a,b){var d,e;switch(d=this,e=c.toArray(arguments),c.type(a)){case"String":if(e.length<2)return this.options[a];this.options[a]=b;break;case"Object":c.each(a,function(a,b){d.config(b,a)});break;case"Undefined":return this.options}return this}}),b.Class.Attributes=b.Class({_attributes:null,attributes:null,_initialize:function(){this.attributes=c.extend(!0,{},this._attributes)},attr:function(a,b){var d,e,f;switch(d=this,e=c.toArray(arguments),f=!1,c.type(a)){case"Undefined":return this.attributes;case"String":return e.length<2?this.attributes[a]:(f=this.attributes[a]!==b,this.attributes[a]=b,f&&c.type(this.trigger,"Function")&&this.trigger("change",{key:a,value:b}),this);case"Object":c.each(a,function(a,b){d.attr(b,a)})}return this}}),b.Class.HashChange=b.Class({_options:{interval:100},timer:null,latest:null,_initialize:function(){var b=this;return"onhashchange"in a?a.addEventListener("hashchange",function(){b.trigger("change")}):void(this.timer=setInterval(this._process,this.config("interval")))},_process:function(){location.hash!==this.latest&&null!==this.latest&&this.trigger("change"),this.latest=location.hash}}).extend(b.Class.Config,b.Class.Events),b.Class.Routes=b.Class({_options:{mode:"path",single:!1},routes:null,hashchange:null,instance:null,_initialize:function(){c.delegate(this,"resolve"),this.routes=[]},push:function(){var a=this;return c.each(arguments,function(b){a.routes.push(b)}),this},start:function(){return this.resolve(),"hash"===this.config("mode")&&(this.hashchange=this.hashchange||new b.Class.HashChange,this.hashchange.off("change").on("change",this.resolve)),this},resolve:function(){var a,b;a=this.config(),b=this,name="hash"===a.mode?location.hash.slice(1):"query"===a.mode?location.search.slice(1):"path"===a.mode?location.pathname:null,c.each(this.routes,function(c){var d=b.validateRoute(name,c);return a.single&&d?!1:void 0})},validateRoute:function(a,d){var e,f,g,h;switch(e=this.config(),f=!1,h=[],c.type(d.rule)){case"String":case"RegExp":h=function(){var b=a.match(d.rule)||[];return c.toArray(b)}(),f=!!h.length;break;case"Function":f=d.rule(a);break;case"Boolean":f=d.rule}if(!f)return!1;switch(e.single&&this.instance&&"_destruct"in this.instance&&c.type(this.instance._destruct,"Function")&&this.instance._destruct(),c.type(d.action)){case"Function":d.action.apply(this,h);break;case"Object":g=b.Class(d.action),this.instance=new g}return!0}}).extend(b.Class.Events,b.Class.Config),b.routes=new b.Class.Routes,b.action=function(){this.routes.push.apply(this.routes,arguments)},b.drip=function(){this.routes.start()},b._modules={},b._instances={},b.define=function(a,d,e){return e=void 0==e?!0:e,(e||a in b._modules)&&(b._modules[a]=c.type(d,"Object")?b.Class(d):d),this},b.find=function(a){return a in b._modules?b._modules[a]:a in b.Class?b.Class[a]:void 0},b.require=function(a,d){var e,f;return e=b.find(a),f=function(a){return c.type(a,"Function")?new a:a},d?f(e):a in b._instances?b._instances[a]:(inst=f(e),b._instances[a]=inst,inst)},a.latte=b}(this);